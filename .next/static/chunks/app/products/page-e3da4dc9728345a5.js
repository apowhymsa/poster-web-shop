(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[286],{395:function(e,t,r){Promise.resolve().then(r.bind(r,8835))},8835:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return v}});var a=r(7437);r(481);var s=r(7759);let c=[{value:"1",label:"Популярные",disabled:!0},{value:"2",label:"Новые",disabled:!0},{value:"3",label:"Цена: Низкая - Высокая",disabled:!0},{value:"4",label:"Цена: Высокая - Низкая",disabled:!0}];var i=e=>{let{onChangeHandler:t,defaultValue:r}=e;return(0,a.jsx)(s.ZP,{options:c,className:"w-[245px]",onChange:t,styles:{control:(e,t)=>({...e,outline:t.isFocused?"1px solid #fb7185 !important":e.outline,border:t.isFocused?"1px solid #fb7185 !important":e.border}),option:(e,t)=>({...e,backgroundColor:t.isFocused?"#fda4af":t.isSelected?"#fb7185":e.backgroundColor,color:t.isFocused||t.isSelected?"white":"black"})},defaultValue:Number(r)>3?c[0]:c[Number(r)-1]})},o=r(7498);r(9640);var l=r(8464),n=r(9993),d=r(2265),u=r(1769),p=e=>{let{isLoading:t}=e,r=(0,d.useMemo)(()=>[0,0,0,0,0,0,0,0],[]),s=(0,l.C)(e=>e.productsReducer).filteredProducts;return(0,a.jsx)("section",{className:"products-container",children:t?r.map(()=>(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(u.Z,{})})):s.length<=0?(0,a.jsx)("div",{children:"Нет товаров по применённым фильтрам"}):s.map(e=>(0,a.jsx)(n.Z,{product:e},e.product_id))})},m=r(7465),f=r(3809);r(8528),r(771);var g=r(6710),h=e=>{let{onAfterChange:t,defaultValue:r}=e,[s,c]=(0,d.useState)(r||[0,1e4]);return(0,a.jsxs)("div",{className:"relative h-[44px]",children:[(0,a.jsx)(g.Z,{className:"horizontal-slider",thumbClassName:"example-thumb",trackClassName:"example-track",min:0,onAfterChange:t,max:1e4,value:s,onChange:e=>c(e),ariaLabel:["Минимальная цена","Максимальная цена"],ariaValuetext:e=>"Thumb value ".concat(e.valueNow),renderThumb:(e,t)=>(0,a.jsx)("div",{...e}),minDistance:10}),(0,a.jsx)("span",{className:"absolute left-[5px]",children:s[0]}),(0,a.jsx)("span",{className:"absolute right-[5px]",children:s[1]})]})},x=e=>{let{setVisible:t,isVisible:r,onChangeFilterPriceHandler:s,onChangeFilterCategoriesHandler:c,priceSliderDefaultValue:i,categoriesFilter:o}=e,n=(0,l.C)(e=>e.categoriesReducer).categories;return(0,a.jsx)("div",{className:r?"categories-filter-container categories-filter-container-active":"categories-filter-container",children:(0,a.jsxs)("div",{className:"categories-filter-content",children:[(0,a.jsxs)("div",{className:"categories",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"Категории"}),(0,a.jsx)("div",{className:"category-grid grid grid-cols-6 gap-5 gap-y-4",children:n.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center gap-x-2 flex-0",children:[(0,a.jsx)("input",{onChange:c,type:"checkbox",checked:!!o.find(t=>t===e.category_id),value:e.category_id,id:e.category_id,className:"h-4 w-4 rounded checked:text-rose-400 shadow-sm text-rose-400 focus:border-rose-300 focus:ring focus:ring-rose-200 focus:ring-offset-0 focus:ring-opacity-50 disabled:cursor-not-allowed disabled:text-gray-400"}),(0,a.jsx)("label",{htmlFor:e.category_id,className:"text-sm text-gray-700",children:e.category_name})]},e.category_id))})]}),(0,a.jsxs)("div",{className:"prices",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"Цена"}),(0,a.jsx)("div",{className:"slider-container w-[400px]",children:(0,a.jsx)(h,{onAfterChange:s,defaultValue:i})})]})]})})},b=r(4033),v=()=>{var e,t;let[r,s]=(0,d.useState)(!1),c=(0,b.useRouter)(),n=(0,b.usePathname)(),u=(0,b.useSearchParams)(),g=e=>{let t=new URLSearchParams(u);return t.get(e)},h=(0,l.T)(),[v,j]=(0,d.useState)(!1),[y,N]=(0,d.useState)((null===(e=g("category"))||void 0===e?void 0:e.split(","))||[]),[C,P]=(0,d.useState)(g("sort")||"1"),[_,w]=(0,d.useState)((null===(t=g("price"))||void 0===t?void 0:t.split("-"))||[0,1e4]);(0,d.useEffect)(()=>{h((0,m.ft)({categoriesFilter:y,sortFilter:C,priceFilter:_}))},[y,C,_]),(0,d.useEffect)(()=>{s(!0);let e=async()=>{let e=await fetch("/api/products",{cache:"no-cache"}),t=await e.json();h((0,m.RU)(t))},t=async()=>{let e=await fetch("/api/categories",{cache:"no-cache"}),t=await e.json();h((0,f.DG)(t))};Promise.all([e(),t()]).finally(()=>{h((0,m.ft)({categoriesFilter:y,sortFilter:C,priceFilter:_})),s(!1)})},[]),(0,d.useEffect)(()=>{console.log("pathname changed")},[n]),(0,d.useEffect)(()=>{c.push("".concat(n,"?").concat(S("category",y.join(","))),{scroll:!1})},[y]),(0,d.useEffect)(()=>{c.push("".concat(n,"?").concat(S("sort",C)),{scroll:!1})},[C]),(0,d.useEffect)(()=>{c.push("".concat(n,"?").concat(S("price",_.join("-"))),{scroll:!1})},[_]);let S=(0,d.useCallback)((e,t)=>{let r=new URLSearchParams(u);return r.set(e,t),r.toString()},[u]);return(0,a.jsxs)("div",{className:"products-page",children:[(0,a.jsxs)("div",{className:"page-top",children:[(0,a.jsx)("h1",{className:"font-bold text-4xl text-white relative z-10",children:"Цветы"}),(0,a.jsx)("h3",{className:"mt-4 font-normal text-gray-50 relative z-10",children:"Самый быстрый способ проявить заботу"})]}),(0,a.jsxs)("aside",{className:"page-filters",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"filters-left flex gap-x-2 items-center",role:"button",onClick:()=>j(e=>!e),children:[(0,a.jsx)(o.Z,{className:"h-5 w-5 text-gray-400"}),(0,a.jsx)("span",{children:"Фильтр"})]}),(0,a.jsx)("span",{className:"filter-divider"}),(0,a.jsx)("span",{className:"text-gray-500 transition-colors hover:text-rose-400",role:"button",onClick:()=>{},children:"Очистить всё"})]}),(0,a.jsx)("div",{children:(0,a.jsx)(i,{onChangeHandler:e=>{console.log(null==e?void 0:e.value),P(e.value.toString())},defaultValue:Number(C)})})]}),(0,a.jsx)(x,{isVisible:v,setVisible:j,onChangeFilterCategoriesHandler:e=>{let t=e.target;if(t.checked)N(e=>[...e,t.value]);else{let e=y.filter(e=>e!==t.value);N(e)}console.log("CHECKED:",t.checked,t.value)},onChangeFilterPriceHandler:(e,t)=>{w(e)},priceSliderDefaultValue:_,categoriesFilter:y}),(0,a.jsx)(p,{isLoading:r})]})}},9993:function(e,t,r){"use strict";var a=r(7437),s=r(6691),c=r.n(s),i=r(1396),o=r.n(i);r(9640);var l=r(8464),n=r(2418),d=r(2265),u=r(8138),p=r(3030);t.Z=e=>{let{product:t,isButtonVisible:r=!0}=e,{info:s,error:i}=(0,p.Z)(),{isLoading:m,isLogged:f}=(0,d.useContext)(u.V),g=(0,l.T)();return(0,l.C)(e=>e.cartReducer).cart,(0,a.jsxs)("div",{className:"product-item",children:[(0,a.jsx)(o(),{className:"product-image",href:"/products/".concat(t.product_id),children:(0,a.jsx)(c(),{src:t.photo_origin?"https://poster-shop.joinposter.com".concat(t.photo_origin):"/flower_image.jpg",alt:"Product Image",width:0,height:0,sizes:"100vw",style:{width:"100%",height:"auto",objectFit:"cover",borderRadius:"8px",objectPosition:"center center",aspectRatio:"1 / 1"},placeholder:"blur",blurDataURL:"/flower_image.jpg",priority:!0})}),(0,a.jsxs)("div",{className:"product-description",children:[(0,a.jsx)(o(),{href:"/products/".concat(t.product_id),className:"product-name",title:t.product_name,children:t.product_name}),(0,a.jsxs)("span",{className:"product-price",children:["₴ ",t.price["1"].slice(0,-2)]})]}),r?(0,a.jsx)("button",{onClick:async()=>{f?(g((0,n.ZW)({product:t,quantity:1})),s("Товар успешно добавлен в корзину")):i("Чтобы добавить товар в корзину, войдите в учётную запись!")},className:"border border-rose-400 text-rose-400 px-4 py-2 rounded transition-colors hover:bg-rose-400 hover:text-white",children:"Добавить в корзину"}):null]})}},1769:function(e,t,r){"use strict";var a=r(7437),s=r(724);t.Z=()=>(0,a.jsxs)("div",{className:"product-item",children:[(0,a.jsx)("div",{className:"product-image",children:(0,a.jsx)(s.Z,{style:{width:"100%",height:"auto",objectFit:"cover",borderRadius:"8px",objectPosition:"center center",aspectRatio:"1 / 1"}})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(s.Z,{}),(0,a.jsx)(s.Z,{})]}),(0,a.jsx)(s.Z,{})]})},8138:function(e,t,r){"use strict";r.d(t,{V:function(){return s}});var a=r(2265);let s=(0,a.createContext)({isLogged:!1,isLoading:!1})},3030:function(e,t,r){"use strict";var a=r(171);t.Z=()=>({error:(e,t)=>{a.toast.error(e,{position:"bottom-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored",...t})},info:(e,t)=>{a.toast.info(e,{position:"bottom-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored",...t})}})},2122:function(e,t,r){"use strict";r.d(t,{I:function(){return o},db:function(){return l}});var a=r(994),s=r(2464),c=r(9978);let i=(0,a.ZF)({apiKey:"AIzaSyByk7n5JzbWrLCffBJXGiXWnc8MZbe0JqU",authDomain:"poster-ecommerce-shop.firebaseapp.com",projectId:"poster-ecommerce-shop",storageBucket:"poster-ecommerce-shop.appspot.com",messagingSenderId:"14361184003",appId:"1:14361184003:web:d17bfd870e4195075bcb36",measurementId:"G-N1HBV39R4Y"}),o=(0,s.v0)(i),l=(0,c.ad)(i)},2418:function(e,t,r){"use strict";r.d(t,{$R:function(){return l},LL:function(){return d},RV:function(){return u},ZW:function(){return o},wz:function(){return n}});var a=r(8340),s=r(9978),c=r(2122);let i=(0,a.oM)({name:"cart",initialState:{cart:[]},reducers:{setCart:(e,t)=>{e.cart=t.payload,console.log("payload",t.payload)},setCartItem:(e,t)=>{let r=localStorage.getItem("authUserId"),a=e.cart.findIndex(e=>e.product.product_id===t.payload.product.product_id);-1!==a?e.cart[a].quantity+=t.payload.quantity:e.cart.push(t.payload),(0,s.pl)((0,s.JU)(c.db,"users",r.toString()),{cart:[...e.cart]},{merge:!0})},updateQuantity:(e,t)=>{let r=localStorage.getItem("authUserId"),a=e.cart.findIndex(e=>e.product.product_id===t.payload.product.product_id);e.cart[a].quantity=t.payload.quantity,(0,s.pl)((0,s.JU)(c.db,"users",r.toString()),{cart:[...e.cart]},{merge:!0})},deleteItem:(e,t)=>{let r=localStorage.getItem("authUserId");e.cart=e.cart.filter(e=>e.product.product_id!==t.payload.product.product_id),(0,s.pl)((0,s.JU)(c.db,"users",r.toString()),{cart:[...e.cart]},{merge:!0})},clearCart:e=>{let t=localStorage.getItem("authUserId");e.cart=[],(0,s.pl)((0,s.JU)(c.db,"users",t.toString()),{cart:[]},{merge:!0})}}}),{setCartItem:o,updateQuantity:l,deleteItem:n,clearCart:d,setCart:u}=i.actions;t.ZP=i.reducer},3809:function(e,t,r){"use strict";r.d(t,{DG:function(){return c}});var a=r(8340);let s=(0,a.oM)({name:"categories",initialState:{categories:[]},reducers:{setCategories:(e,t)=>{e.categories=t.payload}}}),{setCategories:c}=s.actions;t.ZP=s.reducer},8464:function(e,t,r){"use strict";r.d(t,{C:function(){return c},T:function(){return s}});var a=r(3198);let s=()=>(0,a.I0)(),c=a.v9},7465:function(e,t,r){"use strict";r.d(t,{RU:function(){return c},ft:function(){return i}});var a=r(8340);let s=(0,a.oM)({name:"products",initialState:{products:[],filteredProducts:[]},reducers:{setProducts:(e,t)=>{e.products=t.payload,e.filteredProducts=t.payload},filterProducts:(e,t)=>{switch(e.filteredProducts=[...e.products],t.payload.sortFilter){case"1":e.filteredProducts=[...e.products];break;case"2":e.filteredProducts=e.filteredProducts.reverse();break;case"3":e.filteredProducts=e.filteredProducts.sort((e,t)=>Number(e.price["1"].slice(0,-2))<Number(t.price["1"].slice(0,-2))?-1:Number(e.price["1"].slice(0,-2))>Number(t.price["1"].slice(0,-2))?1:0);break;case"4":e.filteredProducts=e.filteredProducts.sort((e,t)=>Number(e.price["1"].slice(0,-2))>Number(t.price["1"].slice(0,-2))?-1:Number(e.price["1"].slice(0,-2))<Number(t.price["1"].slice(0,-2))?1:0)}e.filteredProducts=e.filteredProducts.filter(e=>{let r=Number(e.price["1"].slice(0,-2));return r>=t.payload.priceFilter[0]&&r<=t.payload.priceFilter[1]}),""===t.payload.categoriesFilter[0]?t.payload.categoriesFilter.slice(1).length>0&&(e.filteredProducts=e.filteredProducts.filter(e=>t.payload.categoriesFilter.includes(e.menu_category_id))):t.payload.categoriesFilter.length>0&&(e.filteredProducts=e.filteredProducts.filter(e=>t.payload.categoriesFilter.includes(e.menu_category_id)))}}}),{setProducts:c,filterProducts:i}=s.actions;t.ZP=s.reducer},481:function(){},8528:function(){},9640:function(){},771:function(){}},function(e){e.O(0,[358,214,454,24,234,971,596,744],function(){return e(e.s=395)}),_N_E=e.O()}]);